/* ----------------------------
  rafiqak â€” interactive app JS
  Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø¯Ø§Ø®Ù„ <script> ÙÙŠ Ø£Ø³ÙÙ„ index.html
---------------------------- */

(() => {
  // ====== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³Ù‡ÙˆÙ„Ø©) ======
  const moods = [
    { id: 'joy', emoji: 'ğŸ˜Š', label: 'Ø³Ø¹ÙŠØ¯ / Ù…Ø±ØªØ§Ø­' },
    { id: 'calm', emoji: 'ğŸ˜Œ', label: 'Ù‡Ø§Ø¯Ø¦' },
    { id: 'sad', emoji: 'ğŸ™', label: 'Ø­Ø²ÙŠÙ† Ù‚Ù„ÙŠÙ„Ø§Ù‹' },
    { id: 'stressed', emoji: 'ğŸ˜£', label: 'Ù…ØªÙˆØªØ±' },
    { id: 'over', emoji: 'ğŸ˜«', label: 'Ù…Ø±Ù‡Ù‚ / Ù…Ø«Ù‚Ù„' }
  ];

  const motivational = {
    joy: [
      "Ø¬Ù…ÙŠÙ„ Ø£Ù† ØªØ´Ø¹Ø± Ø¨Ù‡Ø°Ø§! Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ù…Ø§ ÙŠÙ…Ù†Ø­Ùƒ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© â¤ï¸",
      "Ø§Ù†Ø´Ø± Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© Ø­ÙˆÙ„Ùƒ â€” Ø£Ù†Øª ØªØ³ØªØ­Ù‚ Ø§Ù„Ø±Ø§Ø­Ø©.",
      "Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ù„Ù†ÙØ³Ùƒ Ù…Ù‡Ù…ØŒ Ø®Ø° Ù„Ø­Ø¸Ø© Ù„Ø´ÙƒØ± Ù†ÙØ³Ùƒ Ø§Ù„ÙŠÙˆÙ…."
    ],
    calm: [
      "Ù‡Ø¯ÙˆØ¡Ùƒ Ù‚ÙˆØ© â€” Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆØªÙŠØ±Ø© ğŸ˜Š",
      "ØªÙ†ÙØ³ Ø¨Ø¹Ù…Ù‚ Ø¥Ø°Ø§ Ø§Ø­ØªØ¬Øª Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† Ø§Ù„ØµÙØ§Ø¡ Ø§Ù„Ø°Ù‡Ù†ÙŠ.",
      "Ø¬ÙŠØ¯ Ø£Ù†Ùƒ ØªØ´Ø¹Ø± Ø¨Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ø› Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø±ÙˆØªÙŠÙ† ÙŠØ³Ø§Ù†Ø¯Ùƒ."
    ],
    sad: [
      "Ù‡Ø°Ø§ Ø§Ù„Ø´Ø¹ÙˆØ± Ù…Ø¤Ù‚ØªØŒ ÙˆÙ…Ù† Ø§Ù„Ø¬ÙŠØ¯ Ø£Ù†Ùƒ Ù„Ø§Ø­Ø¸Øª Ø­Ø§Ù„ØªÙƒ â€” Ù‡Ø°Ù‡ Ø®Ø·ÙˆØ© Ù…Ù‡Ù…Ø©.",
      "Ø£Ù†Øª Ù„Ø³Øª ÙˆØ­Ø¯ÙƒØ› Ø®Ø° Ù„Ø­Ø¸Ø© Ù„Ù„Ø¹Ù†Ø§ÙŠØ© Ø¨Ù†ÙØ³Ùƒ Ø§Ù„ÙŠÙˆÙ….",
      "Ø§Ø³Ù…Ø­ Ù„Ù†ÙØ³Ùƒ Ø¨Ø§Ù„Ø´Ø¹ÙˆØ±ØŒ Ø«Ù… Ø­Ø§ÙˆÙ„ ÙØ¹Ù„ Ø´ÙŠØ¡ Ø¨Ø³ÙŠØ· ÙŠÙØ³Ø¹Ø¯Ùƒ."
    ],
    stressed: [
      "ØªÙ†ÙÙ‘Ø³ 4-4-4: Ø´Ù‡ÙŠÙ‚ 4 Ø«ÙˆØ§Ù†ÙŠ â€” Ø­Ø¨Ø³ 4 â€” Ø²ÙÙŠØ± 4. ÙƒØ±Ø± 3 Ù…Ø±Ø§Øª.",
      "Ù‚Ø³Ù‘Ù… Ù…Ù‡Ø§Ù…Ùƒ Ù„Ù…Ù‡Ø§Ù… ØµØºÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ â€” Ø¥Ù†Ø¬Ø§Ø² ØµØºÙŠØ± ÙŠØ®ÙÙ Ø§Ù„Ø¶ØºØ·.",
      "Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¨Ø®Ø·ÙˆØ© Ø¨Ø³ÙŠØ·Ø© Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ØªØ²ÙˆÙ„ Ø§Ù„Ø¶ØºÙˆØ·."
    ],
    over: [
      "Ù‡Ø°Ø§ Ø¹Ø¨Ø¡ Ø­Ù‚ÙŠÙ‚ÙŠ. Ø¬Ø±Ù‘Ø¨ Ø£Ù† ØªÙƒØªØ¨ Ø«Ù„Ø§Ø« Ø£Ø´ÙŠØ§Ø¡ ØµØºÙŠØ±Ø© ØªØ³ØªØ·ÙŠØ¹ ÙØ¹Ù„Ù‡Ø§ Ø§Ù„Ø¢Ù†.",
      "Ø§Ø³ØªØ¹Ù† Ø¨Ø´Ø®Øµ Ù…ÙˆØ«ÙˆÙ‚ ÙˆØ´Ø§Ø±ÙƒÙ‡ Ù…Ø§ ØªØ­Ø³ Ø¨Ù‡ â€” Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø© ØªØ±ÙŠØ­.",
      "Ø¥Ø°Ø§ Ø§Ø³ØªÙ…Ø± Ø§Ù„Ø´Ø¹ÙˆØ±ØŒ ÙŠÙØ³ØªØ­Ø³Ù† Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø®ØªØµ ØµØ­ÙŠ."
    ]
  };

  const exercisesPool = {
    joy: [
      {title:"Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù…ØªÙ†Ø§Ù†",desc:"Ø§ÙƒØªØ¨ 3 Ø£Ù…ÙˆØ± Ø£Ù†Øª Ù…Ù…ØªÙ†Ù‘ Ù„Ù‡Ø§ Ø§Ù„ÙŠÙˆÙ… (3 Ø¯Ù‚Ø§Ø¦Ù‚)"},
      {title:"Ù…Ø´ÙŠ Ù‚ØµÙŠØ±",desc:"ØªÙ…Ø´Ù‰ 10 Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø§Ù„Ø·Ù„Ù‚"},
      {title:"ØªÙ…Ø±ÙŠÙ† ØªÙ†ÙÙ‘Ø³",desc:"ØªÙ†ÙÙ‘Ø³ 4-6-8 Ù„Ù…Ø¯Ø© 3 Ø¯Ù‚Ø§Ø¦Ù‚"}
    ],
    calm: [
      {title:"ØªØ£Ù…Ù„ Ù‚ØµÙŠØ±",desc:"Ø¬Ù„Ø³Ø© ØªØ£Ù…Ù„ 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ø¹ ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†ÙÙ‘Ø³"},
      {title:"ÙƒØªØ§Ø¨Ø© Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©",desc:"Ø¯ÙˆÙ‘Ù† Ø¥Ù†Ø¬Ø§Ø² ØµØºÙŠØ± Ø­Ø¯Ø« Ø§Ù„ÙŠÙˆÙ…"},
      {title:"ØªÙ…Ø¯Ø¯",desc:"Ø³Ù„Ø³Ù„Ø© ØªÙ…Ø§Ø±ÙŠÙ† ØªÙ…Ø¯Ø¯ 7 Ø¯Ù‚Ø§Ø¦Ù‚"}
    ],
    sad: [
      {title:"Ù…ÙƒØ§Ù„Ù…Ø© ØµØ¯ÙŠÙ‚",desc:"Ø§ØªØµÙ„ Ø¨Ø£Ø­Ø¯ ØªØ«Ù‚ Ø¨Ù‡ Ù„Ù…Ø¯Ø© 10 Ø¯Ù‚Ø§Ø¦Ù‚"},
      {title:"ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø¹Ø±",desc:"Ø¯ÙˆÙ‘Ù† Ù…Ø§ ØªØ´Ø¹Ø± Ø¨Ù‡ Ø¯ÙˆÙ† Ø­ÙƒÙ… (5-10 Ø¯Ù‚Ø§Ø¦Ù‚)"},
      {title:"Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ù…ÙˆØ³ÙŠÙ‚Ù‰",desc:"Ø§Ø³ØªÙ…Ø¹ Ù„Ø£ØºÙ†ÙŠØ© ØªØ±ÙŠØ­Ùƒ Ø£Ùˆ ØªØ­Ø¨Ù‡Ø§"}
    ],
    stressed: [
      {title:"ØªÙ…Ø§Ø±ÙŠÙ† ØªÙ†ÙÙ‘Ø³",desc:"4-4-4 Ø§Ù„ØªÙ†ÙÙ‘Ø³ Ù„Ù…Ø¯Ù‘Ø© 5 Ø¯Ù‚Ø§Ø¦Ù‚"},
      {title:"Ù‚Ø§Ø¦Ù…Ø© Ù…Ù‡Ø§Ù… ØµØºÙŠØ±Ø©",desc:"Ù‚Ø³Ù‘Ù… Ù…Ù‡Ù…Ù‘Ø© ÙƒØ¨ÙŠØ±Ø© Ø¥Ù„Ù‰ 3 Ù…Ù‡Ø§Ù… ØµØºÙŠØ±Ø©"},
      {title:"ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ø³ØªØ±Ø®Ø§Ø¡",desc:"ØªÙ…Ø§Ø±ÙŠÙ† Ø´Ø¯/Ø§Ø³ØªØ±Ø®Ø§Ø¡ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª 8 Ø¯Ù‚Ø§Ø¦Ù‚"}
    ],
    over: [
      {title:"Ø§Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø©",desc:"Ø­Ø¯Ø¯ Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ù„Ø·Ù„Ø¨ Ø¯Ø¹Ù… (Ù…Ø«Ù„Ø§Ù‹: Ù…Ø±Ø§Ø³Ù„Ø© Ù…Ø³Ø¤ÙˆÙ„)"},
      {title:"Ø§Ø³ØªØ±Ø§Ø­Ø© Ø±Ù‚Ù…ÙŠØ©",desc:"Ø§Ø¨ØªØ¹Ø¯ Ø¹Ù† Ø§Ù„Ø´Ø§Ø´Ø§Øª 20 Ø¯Ù‚ÙŠÙ‚Ø©"},
      {title:"Ù…Ù…Ø§Ø±Ø³Ø© Ø®ÙÙŠÙØ©",desc:"Ù…Ø´ÙŠ Ø¨Ø·ÙŠØ¡ Ø£Ùˆ ØªÙ…Ø§Ø±ÙŠÙ† ØªÙ†ÙÙ‘Ø³ Ù„Ù…Ø¯Ø© 8 Ø¯Ù‚Ø§Ø¦Ù‚"}
    ]
  };

  // ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ ======
  const APP_KEY = 'rafiqak_app_v1';
  function getToday() {
    const d = new Date();
    return d.toISOString().split('T')[0];
  }
  function loadState(){
    try {
      const raw = localStorage.getItem(APP_KEY);
      return raw ? JSON.parse(raw) : {
        mood: null,
        lastDate: null,
        todaysExercises: [],
        completedDates: [],
        streak: 0
      };
    } catch (e) {
      console.error('loadState error', e);
      return { mood:null, lastDate:null, todaysExercises:[], completedDates:[], streak:0 };
    }
  }
  function saveState(s){ localStorage.setItem(APP_KEY, JSON.stringify(s)); }

  // ====== Ø¹Ù†Ø§ØµØ± DOM (ÙŠØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯Ù‡Ø§ Ù„ØªØ¬Ù†Ù‘Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡) ======
  const $$ = id => document.getElementById(id);
  const moodGrid = $$('moodGrid');
  const startBtn = $$('startBtn');
  const supportCard = $$('supportCard');
  const moodCard = $$('moodCard');
  const greeting = $$('greeting');
  const motivationalMessage = $$('motivationalMessage');
  const nextMsgBtn = $$('nextMsgBtn');
  const dailyPlanBtn = $$('dailyPlanBtn');
  const exList = $$('exList');
  const exercisesSection = $$('exercisesSection');
  const resetBtn = $$('resetBtn');
  const notifyBtn = $$('notifyBtn');
  const progressCard = $$('progressCard');
  const streakDisplay = $$('streakDisplay');
  const completeAllBtn = $$('completeAllBtn');
  const exportBtn = $$('exportBtn');

  if (!moodGrid || !startBtn) {
    console.warn('Ø¨Ø¹Ø¶ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© (Ù…Ø«Ù„ moodGrid Ø£Ùˆ startBtn). ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ù„Ù€ id Ø§Ù„ØµØ­ÙŠØ­Ø©.');
  }

  let state = loadState();
  let selectedMood = state.mood || null;

  // ====== Ø¨Ù†Ø§Ø¡ Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø²Ø§Ø¬ (Ø¥ÙŠÙ…ÙˆØ¬ÙŠ) ======
  function buildMoodGrid(){
    if(!moodGrid) return;
    moodGrid.innerHTML = '';
    moods.forEach(m => {
      const el = document.createElement('div');
      el.className = 'mood' + (selectedMood===m.id? ' selected':'');
      el.innerHTML = `<div class="emoji">${m.emoji}</div><div class="label">${m.label}</div>`;
      el.addEventListener('click', () => {
        selectedMood = m.id;
        document.querySelectorAll('.mood').forEach(x=>x.classList.remove('selected'));
        el.classList.add('selected');
      });
      moodGrid.appendChild(el);
    });
  }

  // ====== Ø§Ø®ØªÙŠØ§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ­ÙÙŠØ²ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ======
  function pickMotivational(mood) {
    const arr = motivational[mood] || ["Ø£Ù†Øª Ø¨Ø®ÙŠØ± â€” Ø®Ø·ÙˆØ© ØµØºÙŠØ±Ø© Ø§Ù„Ø¢Ù† Ù‚Ø¯ ØªÙØ±Ù‚ Ù„Ø§Ø­Ù‚Ù‹Ø§."];
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // ====== Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ù… Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø²Ø§Ø¬ ======
  function showSupportFor(mood){
    if(!mood) return;
    state.mood = mood;
    saveState(state);
    const moodObj = moods.find(mm => mm.id === mood);
    if (greeting) greeting.innerText = `Ø£Ù†Øª Ø§Ø®ØªØ±Øª: ${moodObj.emoji}  â€”  ${moodObj.label}`;
    if (motivationalMessage) motivationalMessage.innerText = pickMotivational(mood);
    if (moodCard) moodCard.style.display = 'none';
    if (supportCard) supportCard.style.display = 'block';
    if (progressCard) progressCard.style.display = 'block';
    updateStreakUI();
  }

  // Ø²Ø± "Ø§Ø¨Ø¯Ø£"
  if (startBtn) {
    startBtn.addEventListener('click', () => {
      if (!selectedMood) { alert('Ø§Ø®ØªØ± Ø¥Ø­Ø³Ø§Ø³Ù‹Ø§ Ø£ÙˆÙ„Ø§Ù‹ Ø­ØªÙ‰ Ø£Ø³ØªØ·ÙŠØ¹ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ğŸ˜Š'); return; }
      showSupportFor(selectedMood);
    });
  }

  // Ø²Ø± "Ø¹Ø¨Ø§Ø±Ø© Ø£Ø®Ø±Ù‰"
  if (nextMsgBtn) {
    nextMsgBtn.addEventListener('click', () => {
      if (!state.mood) { alert('Ø§Ø®ØªØ± Ø¥Ø­Ø³Ø§Ø³Ù‹Ø§ Ø£ÙˆÙ„Ø§Ù‹'); return; }
      if (motivationalMessage) motivationalMessage.innerText = pickMotivational(state.mood);
    });
  }

  // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØµÙ†ÙŠÙ
  if (resetBtn) {
    resetBtn.addEventListener('click', () => {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­Ø§Ù„Ø©ØŸ')) return;
      state.mood = null;
      saveState(state);
      selectedMood = null;
      buildMoodGrid();
      if (moodCard) moodCard.style.display = 'block';
      if (supportCard) supportCard.style.display = 'none';
    });
  }

  // ====== Ø®Ø·Ø© Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ======
  function generateTodayPlan(mood){
    const pool = exercisesPool[mood] || [];
    // Ù†Ø®ØªØ§Ø± Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ 2-3 ØªÙ…Ø§Ø±ÙŠÙ†
    const shuffled = pool.slice().sort(()=>Math.random()-0.5);
    return shuffled.slice(0, Math.min(3, shuffled.length));
  }

  function showTodayPlan(){
    if(!state.mood){ alert('Ø§Ø®ØªØ± Ø¥Ø­Ø³Ø§Ø³Ù‹Ø§ Ø£ÙˆÙ„Ø§Ù‹'); return; }
    const today = getToday();
    if (state.lastDate !== today || !state.todaysExercises || state.todaysExercises.length === 0) {
      const plan = generateTodayPlan(state.mood || 'calm');
      state.todaysExercises = plan.map((e, idx) => ({ ...e, done: false, id: idx }));
      state.lastDate = today;
      saveState(state);
    }
    renderExercises();
    if (exercisesSection) exercisesSection.style.display = 'block';
  }

  if (dailyPlanBtn) dailyPlanBtn.addEventListener('click', showTodayPlan);

  function renderExercises(){
    if(!exList) return;
    exList.innerHTML = '';
    if (!state.todaysExercises || state.todaysExercises.length === 0) {
      exList.innerHTML = `<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ…Ø§Ø±ÙŠÙ† Ù„Ù„ÙŠÙˆÙ…. Ø§Ø¶ØºØ· "Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ…" Ù„ØªÙˆÙ„ÙŠØ¯ ØªÙ…Ø§Ø±ÙŠÙ†.</div>`;
      return;
    }
    state.todaysExercises.forEach(item => {
      const div = document.createElement('div');
      div.className = 'ex-item';
      div.innerHTML = `
        <div>
          <div class="title">${item.title}</div>
          <div class="small">${item.desc}</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn ghost" data-id="${item.id}">${item.done ? 'âœ… ØªÙ…' : 'Ø§Ø¨Ø¯Ø£'}</button>
        </div>
      `;
      exList.appendChild(div);
    });

    // Ø£Ø­Ø¯Ø§Ø« Ø£Ø²Ø±Ø§Ø± ÙƒÙ„ ØªÙ…Ø±ÙŠÙ†
    exList.querySelectorAll('button').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = Number(btn.getAttribute('data-id'));
        state.todaysExercises = state.todaysExercises.map(e => e.id === id ? { ...e, done: !e.done } : e);
        saveState(state);
        renderExercises();
        // Ø¥Ø°Ø§ Ø£Ù†Ø¬Ø²Øª ÙƒÙ„ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†ØŒ ÙˆØ³Ø¬Ù„Ù†Ø§ Ø§Ù„ÙŠÙˆÙ… ÙƒÙ…ÙƒØªÙ…Ù„
        markCompletionIfAllDone();
      });
    });
  }

  function markCompletionIfAllDone(){
    if (!state.todaysExercises || state.todaysExercises.length === 0) return;
    const allDone = state.todaysExercises.every(e => e.done);
    if (allDone) {
      const today = getToday();
      if (!state.completedDates.includes(today)) {
        state.completedDates.push(today);
        state.streak = computeStreak(state.completedDates);
        saveState(state);
        updateStreakUI();
      }
    }
  }

  if (completeAllBtn) {
    completeAllBtn.addEventListener('click', () => {
      if (!state.todaysExercises) return;
      state.todaysExercises = state.todaysExercises.map(e => ({ ...e, done: true }));
      const today = getToday();
      if (!state.completedDates.includes(today)) state.completedDates.push(today);
      state.streak = computeStreak(state.completedDates);
      saveState(state);
      renderExercises();
      updateStreakUI();
      alert('Ø±Ø§Ø¦Ø¹ â€” ØªÙ… ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø¥Ù†Ø¬Ø§Ø² Ù„Ù„ÙŠÙˆÙ… ğŸ‰');
    });
  }

  function computeStreak(dates){
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ© Ø­ØªÙ‰ Ø§Ù„ÙŠÙˆÙ…
    const set = new Set(dates);
    let count = 0;
    let cur = new Date();
    while (true) {
      const s = cur.toISOString().split('T')[0];
      if (set.has(s)) { count++; cur.setDate(cur.getDate() - 1); } else break;
    }
    return count;
  }

  function updateStreakUI(){
    if (!streakDisplay) return;
    streakDisplay.innerText = (state.streak || 0) + ((state.streak === 1) ? " ÙŠÙˆÙ…" : " Ø£ÙŠØ§Ù…");
  }

  // ====== Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ (ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø³ÙŠØ·) ======
  if (notifyBtn) {
    notifyBtn.addEventListener('click', async () => {
      if (!('Notification' in window)) { alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª.'); return; }
      const perm = await Notification.requestPermission();
      if (perm === 'granted') {
        notifyBtn.innerText = 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ±';
        notifyBtn.disabled = true;
        new Notification('Ø±ÙÙŠÙ‚Ùƒ', { body: 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ â€” Ø³Ø£Ø°ÙƒØ±Ùƒ Ø¨Ù…Ù‡Ù…ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©!' });
      } else {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ Ø¥Ø°Ø§ Ø±ØºØ¨Øª Ø¨Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª.');
      }
    });
  }
